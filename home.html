<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plant Box - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ß‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-green: #2d6a4f;
      --light-green: #52b788;
      --bg-light: #f1faee;
      --card-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    body {
      background: linear-gradient(135deg, #f1faee 0%, #e8f5e9 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding-bottom: 80px;
    }

    .header-gradient {
      background: linear-gradient(135deg, var(--primary-green) 0%, var(--light-green) 100%);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      padding: 2rem 0;
    }

    .header-gradient h1 {
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      animation: fadeInDown 0.8s ease;
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stats-card {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      animation: fadeIn 0.6s ease;
    }

    .stats-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .stats-icon {
      font-size: 2rem;
      color: var(--light-green);
    }

    .box {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
      animation: slideUp 0.5s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-green), var(--light-green));
    }

    .box:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      border-color: var(--light-green);
    }

    .sensor-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-green);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .status-badge {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 0.4rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .status-online {
      background: #d4edda;
      color: #155724;
    }

    .status-offline {
      background: #f8d7da;
      color: #721c24;
    }

    .btn-gradient {
      background: linear-gradient(135deg, var(--primary-green), var(--light-green));
      border: none;
      color: white;
      padding: 0.8rem 2rem;
      border-radius: 25px;
      font-weight: 600;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }

    .btn-gradient:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
      color: white;
    }

    .modal-content {
      border-radius: 15px;
      border: none;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .modal-header {
      background: linear-gradient(135deg, var(--primary-green), var(--light-green));
      color: white;
      border-radius: 15px 15px 0 0;
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--light-green);
      box-shadow: 0 0 0 0.25rem rgba(82, 183, 136, 0.25);
    }

    .analysis-result {
      background: linear-gradient(135deg, #e8f5e9 0%, #f1faee 100%);
      padding: 1rem;
      border-radius: 10px;
      border-left: 4px solid var(--light-green);
      margin-top: 1rem;
      animation: slideIn 0.5s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .progress-bar-animated {
      background: linear-gradient(90deg, var(--primary-green), var(--light-green));
    }

    footer {
      background: linear-gradient(135deg, var(--primary-green), var(--light-green));
      position: fixed;
      bottom: 0;
      width: 100%;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
    }

    .info-card {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 0.5rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
      transition: all 0.2s ease;
    }

    .info-card:hover {
      box-shadow: 0 4px 8px rgba(0,0,0,0.12);
      transform: translateX(5px);
    }

    .loading-spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .search-box {
      max-width: 400px;
      margin: 0 auto 2rem;
    }

    .filter-chips {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 1.5rem;
    }

    .filter-chip {
      padding: 0.5rem 1rem;
      border-radius: 20px;
      border: 2px solid var(--light-green);
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .filter-chip:hover, .filter-chip.active {
      background: var(--light-green);
      color: white;
    }

    @media (max-width: 768px) {
      .sensor-value { font-size: 1.5rem; }
      .stats-card { padding: 1rem; }
      .box { padding: 1rem; }
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="header-gradient text-center text-white">
    <div class="container">
      <h1><i class="fas fa-seedling"></i> Plant Box</h1>
      <p class="lead mb-0">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ß‡∏ô‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ - ‡∏î‡∏π‡πÅ‡∏•‡∏ï‡πâ‡∏ô‡πÑ‡∏°‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</p>
    </div>
  </div>

  <!-- Stats Dashboard -->
  <div class="container mt-4">
    <div class="row g-3">
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <i class="fas fa-box stats-icon"></i>
          <h3 class="mt-2 mb-0" id="totalBoxes">0</h3>
          <small class="text-muted">‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</small>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <i class="fas fa-signal stats-icon"></i>
          <h3 class="mt-2 mb-0 text-success" id="onlineBoxes">0</h3>
          <small class="text-muted">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</small>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <i class="fas fa-temperature-high stats-icon"></i>
          <h3 class="mt-2 mb-0" id="avgTemp">--</h3>
          <small class="text-muted">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</small>
        </div>
      </div>
      <div class="col-md-3 col-6">
        <div class="stats-card text-center">
          <i class="fas fa-tint stats-icon"></i>
          <h3 class="mt-2 mb-0" id="avgMoisture">--</h3>
          <small class="text-muted">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Controls -->
  <main class="container mt-4 mb-5">
    <div class="text-center mb-4">
      <button class="btn btn-gradient" data-bs-toggle="modal" data-bs-target="#addBoxModal">
        <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
      </button>
      <button class="btn btn-outline-success ms-2" onclick="updateAllBoxes()">
        <i class="fas fa-sync-alt"></i> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
      </button>
      <button class="btn btn-outline-danger ms-2" onclick="exportData()">
        <i class="fas fa-download"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      </button>
    </div>

    <!-- Search and Filter -->
    <div class="search-box">
      <input type="text" class="form-control" id="searchBox" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä...">
    </div>

    <div class="filter-chips">
      <span class="filter-chip active" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
      <span class="filter-chip" data-filter="online">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
      <span class="filter-chip" data-filter="offline">‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span>
      <span class="filter-chip" data-filter="ready">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö</span>
    </div>

    <div id="additionalBoxes" class="row g-3"></div>
    <div id="noBoxes" class="text-center text-muted mt-5" style="display:none;">
      <i class="fas fa-seedling fa-4x mb-3 opacity-25"></i>
      <h4>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏•‡πà‡∏≠‡∏á</h4>
      <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
    </div>
  </main>

  <!-- Add Box Modal -->
  <div class="modal fade" id="addBoxModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title"><i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="addBoxForm">
            <div class="mb-3">
              <label class="form-label"><i class="fas fa-link"></i> API URL</label>
              <input type="url" class="form-control" id="apiUrl" required 
                     placeholder="http://192.168.1.100:8000/api/sensor/latest">
              <small class="text-muted">URL ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡πá‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö JSON</small>
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="fas fa-tag"></i> ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πà‡∏≠‡∏á</label>
              <input type="text" class="form-control" id="boxName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô">
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label"><i class="fas fa-calendar"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏π‡∏Å</label>
                <input type="date" class="form-control" id="plantDate" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label"><i class="fas fa-leaf"></i> ‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä</label>
                <select class="form-select" id="plantType" required>
                  <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä</option>
                  <option value="‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®">‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®</option>
                  <option value="‡∏û‡∏£‡∏¥‡∏Å">‡∏û‡∏£‡∏¥‡∏Å</option>
                  <option value="‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î">‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î</option>
                  <option value="‡∏ú‡∏±‡∏Å‡∏ö‡∏∏‡πâ‡∏á">‡∏ú‡∏±‡∏Å‡∏ö‡∏∏‡πâ‡∏á</option>
                  <option value="‡πÅ‡∏ï‡∏á‡∏Å‡∏ß‡∏≤">‡πÅ‡∏ï‡∏á‡∏Å‡∏ß‡∏≤</option>
                  <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label"><i class="fas fa-ruler-vertical"></i> ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡πÅ‡∏£‡∏Å‡∏õ‡∏•‡∏π‡∏Å (‡∏ã‡∏°.)</label>
              <input type="number" class="form-control" id="plantHeight" required 
                     placeholder="5" min="0" step="0.1">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="button" class="btn btn-gradient" onclick="addBox()">
            <i class="fas fa-check"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- How to Use Section -->
  <section id="how-to-use" class="py-5">
    <div class="container">
      <h2 class="text-center mb-4 fw-bold">
        <i class="fas fa-question-circle"></i> ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      </h2>
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="info-card">
            <h5><i class="fas fa-1"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h5>
            <p class="mb-0 text-secondary">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà" ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• API ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏û‡∏∑‡∏ä</p>
          </div>
          <div class="info-card">
            <h5><i class="fas fa-2"></i> ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h5>
            <p class="mb-0 text-secondary">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</p>
          </div>
          <div class="info-card">
            <h5><i class="fas fa-3"></i> ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï</h5>
            <p class="mb-0 text-secondary">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï</p>
          </div>
          <div class="info-card">
            <h5><i class="fas fa-4"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡πà‡∏≠‡∏á</h5>
            <p class="mb-0 text-secondary">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠ ‡∏•‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
          </div>
          <div class="info-card">
            <h5><i class="fas fa-5"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h5>
            <p class="mb-0 text-secondary">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå JSON</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="text-light py-3">
    <div class="container text-center">
      <p class="mb-0">
        <i class="fas fa-heart"></i> ¬© 2025 Plant Box Project | Rattanathibate School
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let boxData = [];
    let boxTimes = [];
    let currentFilter = 'all';

    function formatDateTime(dateStr) {
      if (!dateStr) return "--/--/---- --:--:--";
      const d = new Date(dateStr);
      if (isNaN(d)) return "--/--/---- --:--:--";
      return d.toLocaleString('th-TH', { 
        day: '2-digit', 
        month: '2-digit', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
    }

    function updateStats() {
      const total = boxData.length;
      let online = 0;
      let tempSum = 0, tempCount = 0;
      let moistSum = 0, moistCount = 0;

      boxData.forEach(box => {
        if (box.online) {
          online++;
          if (box.temperature && !isNaN(box.temperature)) {
            tempSum += parseFloat(box.temperature);
            tempCount++;
          }
          if (box.moisture && !isNaN(box.moisture)) {
            moistSum += parseFloat(box.moisture);
            moistCount++;
          }
        }
      });

      document.getElementById('totalBoxes').textContent = total;
      document.getElementById('onlineBoxes').textContent = online;
      document.getElementById('avgTemp').textContent = tempCount > 0 
        ? (tempSum / tempCount).toFixed(1) + '¬∞C' 
        : '--';
      document.getElementById('avgMoisture').textContent = moistCount > 0 
        ? (moistSum / moistCount).toFixed(1) + '%' 
        : '--';
    }

    async function updateBox(box, boxElement) {
      const apiUrl = box.api;
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error("API error");
        const data = await res.json();
        
        if (data.length > 0) {
          box.temperature = data[0].temperature;
          box.moisture = data[0].moisture;
          box.timestamp = data[0].timestamp;
          box.online = true;

          boxElement.querySelector(".temp").innerHTML = `<i class="fas fa-thermometer-half"></i> ${box.temperature} ¬∞C`;
          boxElement.querySelector(".moisture").innerHTML = `<i class="fas fa-tint"></i> ${box.moisture} %`;
          
          const dt = new Date(data[0].timestamp.replace(' ', 'T'));
          const datetimeEl = boxElement.querySelector(".datetime");
          datetimeEl.innerText = formatDateTime(dt);
          
          boxElement.querySelector('.status-badge').className = 'status-badge status-online';
          boxElement.querySelector('.status-badge').innerHTML = '<i class="fas fa-check-circle"></i> ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå';
        }
      } catch {
        box.online = false;
        box.temperature = null;
        box.moisture = null;
        
        boxElement.querySelector(".temp").innerHTML = '<i class="fas fa-thermometer-half"></i> -- ¬∞C';
        boxElement.querySelector(".moisture").innerHTML = '<i class="fas fa-tint"></i> -- %';
        boxElement.querySelector(".datetime").innerText = "--/--/---- --:--:--";
        boxElement.querySelector('.status-badge').className = 'status-badge status-offline';
        boxElement.querySelector('.status-badge').innerHTML = '<i class="fas fa-times-circle"></i> ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå';
      }
    }

    async function updateAllBoxes() {
      const boxes = document.querySelectorAll("#additionalBoxes .box");
      for (let i = 0; i < boxes.length; i++) {
        await updateBox(boxData[i], boxes[i]);
      }
      updateStats();
      applyFilter(currentFilter);
    }

    function createBoxElement(box, index) {
      const col = document.createElement("div");
      col.classList.add("col-12", "col-md-6", "col-lg-4", "box-item");
      col.setAttribute('data-index', index);

      const boxDiv = document.createElement("div");
      boxDiv.classList.add("box");

      boxDiv.innerHTML = `
        <span class="status-badge status-offline"><i class="fas fa-times-circle"></i> ‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå</span>
        
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0 box-name"><i class="fas fa-box"></i> ${box.name}</h4>
          <div class="btn-group btn-group-sm">
            <button class="btn btn-outline-info analyze-btn" title="‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå">
              <i class="fas fa-chart-line"></i>
            </button>
            <button class="btn btn-outline-warning edit-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-outline-danger delete-btn" title="‡∏•‡∏ö">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>

        <div class="row mb-3 small">
          <div class="col-6">
            <i class="fas fa-calendar-alt text-success"></i> <strong>‡∏ß‡∏±‡∏ô‡∏õ‡∏•‡∏π‡∏Å:</strong><br>
            <span class="plant-date">${box.plantDate || "-"}</span>
          </div>
          <div class="col-6">
            <i class="fas fa-leaf text-success"></i> <strong>‡∏ä‡∏ô‡∏¥‡∏î:</strong><br>
            <span class="plant-type">${box.plantType || "-"}</span>
          </div>
        </div>

        <div class="row text-center mb-3">
          <div class="col-4">
            <div class="sensor-value temp">--</div>
            <small class="text-muted">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏î‡∏¥‡∏ô</small>
          </div>
          <div class="col-4">
            <div class="sensor-value moisture">--</div>
            <small class="text-muted">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏î‡∏¥‡∏ô</small>
          </div>
          <div class="col-4">
            <div class="datetime small fw-bold" style="font-size: 0.75rem;">--:--:--</div>
            <small class="text-muted">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</small>
          </div>
        </div>

        <div class="analysis-result" style="display:none;"></div>
      `;

      boxDiv.querySelector(".delete-btn").addEventListener("click", () => {
        if (confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ?")) {
          boxData.splice(index, 1);
          renderBoxes();
          saveToStorage();
        }
      });

      boxDiv.querySelector(".edit-btn").addEventListener("click", () => {
        const newName = prompt("‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà:", box.name);
        if (newName && newName.trim()) {
          box.name = newName.trim();
          renderBoxes();
          saveToStorage();
        }
      });

      boxDiv.querySelector(".analyze-btn").addEventListener("click", async () => {
        const resultEl = boxDiv.querySelector(".analysis-result");
        resultEl.style.display = 'block';
        resultEl.innerHTML = '<div class="text-center"><div class="loading-spinner"></div> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</div>';

        try {
          const res = await fetch('http://192.168.15.1:8000/api/predict_growth', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              plantDate: box.plantDate,
              plantType: box.plantType,
              plantHeight: box.plantHeight,
              temperature: parseFloat(box.temperature || 0),
              moisture: parseFloat(box.moisture || 0)
            })
          });
          
          if (!res.ok) throw new Error("API error");
          const result = await res.json();
          
          if (result.error) {
            resultEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${result.error}`;
            return;
          }

          const today = new Date();
          const harvestDate = new Date(result.estimated_harvest_date);
          const isReady = today >= harvestDate;
          
          box.isReady = isReady;

          resultEl.innerHTML = `
            <div class="d-flex align-items-center mb-2">
              <i class="fas ${isReady ? 'fa-check-circle text-success' : 'fa-clock text-warning'} me-2"></i>
              <strong>${isReady ? '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï!' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏Å‡πá‡∏ö'}</strong>
            </div>
            <div class="small">
              <i class="fas fa-calendar-check"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö: ${result.estimated_harvest_date}<br>
              <i class="fas fa-chart-line"></i> ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï: ${result.growth_rate_cm_per_day} ‡∏ã‡∏°./‡∏ß‡∏±‡∏ô
            </div>
          `;
        } catch (error) {
          resultEl.innerHTML = `<i class="fas fa-exclamation-circle"></i> ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`;
        }
      });

      col.appendChild(boxDiv);
      return col;
    }

    function renderBoxes() {
      const container = document.getElementById("additionalBoxes");
      const noBoxes = document.getElementById("noBoxes");
      
      container.innerHTML = "";
      
      if (boxData.length === 0) {
        noBoxes.style.display = 'block';
        return;
      }
      
      noBoxes.style.display = 'none';
      boxData.forEach((box, index) => {
        const boxEl = createBoxElement(box, index);
        container.appendChild(boxEl);
      });
      
      updateAllBoxes();
    }

    function addBox() {
      const apiUrl = document.getElementById('apiUrl').value.trim();
      const name = document.getElementById('boxName').value.trim();
      const plantDate = document.getElementById('plantDate').value;
      const plantType = document.getElementById('plantType').value;
      const plantHeight = document.getElementById('plantHeight').value;

      if (!apiUrl || !name || !plantDate || !plantType || !plantHeight) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
        return;
      }

      boxData.push({
        api: apiUrl,
        name: name
